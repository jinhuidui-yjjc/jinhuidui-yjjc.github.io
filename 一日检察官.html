<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>正义链：检察官的24小时</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" crossorigin="anonymous">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700;900&display=swap');
    
    :root {
      font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
      line-height: 1.6;
      font-weight: 400;
      font-synthesis: none;
      text-rendering: optimizeLegibility;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background: linear-gradient(to bottom right, #0f172a, #1e3a8a);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 1rem;
    }
    
    .container {
      width: 100%;
      max-width: 420px;
      min-height: 100vh;
      background: white;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      overflow: hidden;
      position: relative;
    }
    
    .screen {
      display: none;
      min-height: 100vh;
    }
    
    .screen.active {
      display: block;
    }
    
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease-in-out;
    }
    
    .pulse {
      animation: pulse 2s infinite;
    }
    
    .slide-up {
      animation: slideUp 0.5s ease-out;
    }
    
    /* Cover Screen Styles */
    .cover-screen {
      text-align: center;
      padding: 3rem;
      background: linear-gradient(to bottom right, #0f172a, #1e3a8a);
      color: white;
    }
    
    .cover-icon {
      width: 120px;
      height: 120px;
      background: linear-gradient(to bottom right, #facc15, #d97706);
      border-radius: 50%;
      margin: 0 auto 2rem auto;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 60px;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }
    
    .cover-title {
      font-weight: 900;
      font-size: 1.8rem;
      margin-bottom: 1.5rem;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .cover-description {
      font-size: 1rem;
      opacity: 0.9;
      margin-bottom: 1.5rem;
      padding: 0 1rem;
    }
    
    .start-button {
      background: linear-gradient(to bottom right, #facc15, #d97706);
      color: #0f172a;
      border: none;
      padding: 1rem 3rem;
      font-size: 1.2rem;
      font-weight: 700;
      border-radius: 9999px;
      cursor: pointer;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }
    
    .start-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 15px 20px -5px rgba(0, 0, 0, 0.1);
    }
    
    .start-button:active {
      transform: scale(0.98);
    }
    
    /* Case Screen Styles */
    .case-screen {
      padding: 1.5rem;
      background: white;
    }
    
    .case-header {
      background: #0f172a;
      color: white;
      padding: 1rem;
      margin: -1.5rem -1.5rem 1.5rem -1.5rem;
      border-bottom-left-radius: 1rem;
      border-bottom-right-radius: 1rem;
    }
    
    .case-number {
      font-size: 0.9rem;
      opacity: 0.8;
      margin-bottom: 0.2rem;
    }
    
    .case-title {
      font-size: 1.4rem;
      font-weight: 700;
      font-family: 'Noto Sans SC', serif;
    }
    
    .case-content {
      background: #f8fafc;
      padding: 1rem;
      border-radius: 0.75rem;
      border-left: 4px solid #0f172a;
      margin-bottom: 1rem;
      font-size: 0.95rem;
      line-height: 1.6;
    }
    
    .options-container {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    
    .option {
      background: white;
      border: 2px solid #e2e8f0;
      border-radius: 0.75rem;
      padding: 1rem;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .option:hover {
      border-color: #0f172a;
    }
    
    .option.selected {
      border-color: #0f172a;
      background: #f0f9ff;
    }
    
    .option-text {
      font-size: 0.95rem;
      margin-bottom: 0.3rem;
      padding-right: 2rem;
    }
    
    .option-hint {
      font-size: 0.8rem;
      opacity: 0.7;
      margin-top: 0.5rem;
      padding-top: 0.5rem;
      border-top: 1px dashed #cbd5e1;
      display: none;
    }
    
    .option.selected .option-hint {
      display: block;
    }
    
    .option-correct {
      position: absolute;
      right: 0.8rem;
      top: 50%;
      transform: translateY(-50%);
      color: #10b981;
      font-size: 1.25rem;
      font-weight: bold;
      display: none;
    }
    
    .option.selected .option-correct {
      display: block;
    }
    
    .next-button {
      background: linear-gradient(to bottom right, #0f172a, #1e3a8a);
      color: white;
      border: none;
      padding: 0.9rem 2.5rem;
      font-size: 1rem;
      font-weight: 700;
      border-radius: 9999px;
      cursor: pointer;
      margin-top: 1.5rem;
      width: 100%;
      display: none;
    }
    
    .next-button.visible {
      display: block;
    }
    
    /* Result Screen Styles */
    .result-screen {
      padding: 2rem 1.5rem;
      background: white;
    }
    
    .result-header {
      background: linear-gradient(to bottom right, #facc15, #d97706);
      text-align: center;
      padding: 2.5rem 1.5rem;
      margin: -2rem -1.5rem 2rem -1.5rem;
      color: #0f172a;
    }
    
    .score-circle {
      width: 150px;
      height: 150px;
      background: white;
      border-radius: 50%;
      margin: 0 auto 1.5rem auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }
    
    .score-number {
      font-size: 3rem;
      font-weight: 900;
      font-family: 'Noto Sans SC', serif;
    }
    
    .score-label {
      font-size: 0.9rem;
      opacity: 0.8;
    }
    
    .rank-badge {
      background: #0f172a;
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: 9999px;
      font-size: 1.25rem;
      font-weight: 700;
      display: inline-block;
      margin-bottom: 1.5rem;
    }
    
    .rank-title {
      font-size: 1.5rem;
      font-weight: 900;
      margin-bottom: 0.75rem;
    }
    
    .rank-description {
      font-size: 1rem;
      opacity: 0.9;
    }
    
    .skills-container {
      background: #f8fafc;
      padding: 1.5rem;
      border-radius: 1rem;
      margin-bottom: 2rem;
    }
    
    .skills-title {
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      text-align: center;
    }
    
    .skill-item {
      margin-bottom: 1.25rem;
    }
    
    .skill-header {
      font-size: 0.9rem;
      margin-bottom: 0.4rem;
      display: flex;
      justify-content: space-between;
    }
    
    .skill-bar-container {
      height: 8px;
      background: #e2e8f0;
      border-radius: 4px;
      overflow: hidden;
    }
    
    .skill-bar {
      height: 100%;
      background: linear-gradient(to right, #0f172a, #1e3a8a);
      border-radius: 4px;
      width: 0%;
      transition: width 1s ease-out;
    }
    
    .comment-container {
      background: white;
      border: 2px solid #0f172a;
      border-radius: 1rem;
      padding: 1.5rem;
      margin-bottom: 2rem;
      font-size: 1rem;
      font-style: italic;
    }
    
    .action-buttons {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    .share-button {
      background: linear-gradient(to bottom right, #10b981, #047857);
      color: white;
      border: none;
      padding: 1rem 2.5rem;
      font-size: 1.1rem;
      font-weight: 700;
      border-radius: 9999px;
      cursor: pointer;
      width: 100%;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    
    .share-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }
    
    .restart-button {
      background: white;
      color: #0f172a;
      border: 2px solid #0f172a;
      padding: 1rem 2.5rem;
      font-size: 1rem;
      font-weight: 700;
      border-radius: 9999px;
      cursor: pointer;
      width: 100%;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Cover Screen -->
    <div id="coverScreen" class="screen active cover-screen fade-in">
      <div class="cover-icon pulse">⚖️</div>
      <h1 class="cover-title">正义链：检察官的24小时</h1>
      <p class="cover-description">恭喜您成为A市检察院见习检察官！今天是你入职第一天，24小时内你将面临10个紧急任务。每个选择都会影响你的"正义值"和最终评级。</p>
      <p class="cover-description">准备好了吗？开始你的检察官之旅！</p>
      <button id="startButton" class="start-button">开始挑战 →</button>
    </div>
    
    <!-- Case Screen -->
    <div id="caseScreen" class="screen case-screen">
      <div class="case-header">
        <div id="caseNumber" class="case-number">案件 #1/10</div>
        <h2 id="caseTitle" class="case-title"></h2>
      </div>
      
      <div id="caseContent" class="case-content"></div>
      
      <div id="optionsContainer" class="options-container"></div>
      
      <button id="nextButton" class="next-button">下一个案件 →</button>
    </div>
    
    <!-- Result Screen -->
    <div id="resultScreen" class="screen result-screen">
      <div class="result-header">
        <div class="score-circle">
          <div id="finalScore" class="score-number">0</div>
          <div class="score-label">正义值</div>
        </div>
        <div id="rankBadge" class="rank-badge">见习检察官</div>
        <h3 id="rankTitle" class="rank-title">初窥门径，继续学习</h3>
        <p id="rankDescription" class="rank-description">您对检察工作有初步认识，建议加强学习。</p>
      </div>
      
      <div class="skills-container">
        <h4 class="skills-title">能力评估</h4>
        <div id="skillsContainer" class="skills-list">
          <!-- Skills will be dynamically added here -->
        </div>
      </div>
      
      <div id="commentContainer" class="comment-container">
        <!-- Comment will be dynamically added here -->
      </div>
      
      <div class="action-buttons">
        <button id="shareButton" class="share-button">分享结果</button>
        <button id="restartButton" class="restart-button">重新开始</button>
      </div>
    </div>
  </div>

  <script>
    // 等待DOM完全加载后再执行代码
    document.addEventListener('DOMContentLoaded', function() {
      // Game data and types
      const ProcuratorialType = {
        CRIMINAL: 'criminal',
        CIVIL: 'civil',
        ADMINISTRATIVE: 'administrative',
        PUBLIC_INTEREST: 'publicInterest',
        JUVENILE: 'juvenile'
      };
      
      // Game cases data
      const cases = [
        {
          number: 1,
          title: "盗窃案审查逮捕",
          content: "早上8点，你收到一起盗窃案的审查逮捕材料。犯罪嫌疑人张某在超市盗窃了价值2000元的商品，被当场抓获。经审查，张某是一名刚毕业的大学生，无犯罪前科，被盗商品已全部追回。",
          type: ProcuratorialType.CRIMINAL,
          options: [
            {
              text: "不批准逮捕，张某系初犯、偶犯，主观恶性较小",
              hint: "完全正确！根据宽严相济刑事政策，对于初犯、偶犯且情节较轻的犯罪嫌疑人，可以依法不批准逮捕。",
              score: 10
            },
            {
              text: "批准逮捕，因为盗窃金额已达到追诉标准",
              hint: "不完全正确。虽然盗窃金额已达追诉标准，但还需综合考虑犯罪情节、社会危害性等因素。",
              score: 5
            },
            {
              text: "退回公安机关补充侦查，要求补充社会危险性证据",
              hint: "不完全错误。虽然案件事实清楚，但对社会危险性评估可以进一步完善。",
              score: 2
            },
            {
              text: "建议公安机关撤销案件",
              hint: "完全错误。本案已构成犯罪，不符合撤销案件的条件。",
              score: 0
            }
          ]
        },
        {
          number: 2,
          title: "民事诉讼监督申请",
          content: "上午10点，一位老人来到检察院，申请对一起民事判决进行监督。老人称其在房屋买卖纠纷中败诉，但有新证据证明对方存在欺诈行为。",
          type: ProcuratorialType.CIVIL,
          options: [
            {
              text: "告知老人应先向法院申请再审，如法院驳回再审申请或逾期未作出裁定，再来申请检察监督",
              hint: "完全正确！根据民事诉讼法规定，当事人申请检察监督前应当先向人民法院申请再审。",
              score: 10
            },
            {
              text: "接收申请材料并告知老人需要补充法院裁判文书等材料",
              hint: "不完全正确。虽然接收了材料，但未明确告知申请监督的前置程序。",
              score: 5
            },
            {
              text: "直接受理申请并启动监督程序，因为老人年龄较大，应给予特殊照顾",
              hint: "不完全错误。虽然出发点是好的，但违反了法定程序要求。",
              score: 2
            },
            {
              text: "以超过申请期限为由不予受理",
              hint: "完全错误。未了解具体情况就做出判断，可能损害当事人的合法权益。",
              score: 0
            }
          ]
        },
        {
          number: 3,
          title: "未成年人犯罪案件",
          content: "下午1点，你收到一起未成年人犯罪案件。15岁的李某因琐事与同学发生争执，将对方打成轻伤。经调查，李某平时表现良好，此次系一时冲动，其监护人表示愿意积极赔偿并进行管教。",
          type: ProcuratorialType.JUVENILE,
          options: [
            {
              text: "对李某作出附条件不起诉决定，设定6个月的考验期",
              hint: "完全正确！对于涉嫌犯罪但情节较轻的未成年人，可以依法作出附条件不起诉决定，给予其改过自新的机会。",
              score: 10
            },
            {
              text: "提起公诉，但建议法院适用缓刑",
              hint: "不完全正确。虽然考虑到了从轻处罚，但没有充分体现对未成年人教育为主、惩罚为辅的原则。",
              score: 5
            },
            {
              text: "建议公安机关对李某进行治安处罚",
              hint: "不完全错误。虽然李某已构成犯罪，但考虑到其未成年身份，可以在法律允许的范围内灵活处理。",
              score: 2
            },
            {
              text: "依法提起公诉，要求法院从重处罚",
              hint: "完全错误。违反了对未成年人犯罪教育为主、惩罚为辅的原则。",
              score: 0
            }
          ]
        },
        {
          number: 4,
          title: "环境污染公益诉讼线索",
          content: "下午3点，你接到群众举报，某化工厂偷偷排放污水，污染了附近河流。经初步调查，情况属实，但尚未造成严重后果。",
          type: ProcuratorialType.PUBLIC_INTEREST,
          options: [
            {
              text: "向环保部门发出检察建议，督促其依法履职，同时开展调查取证工作",
              hint: "完全正确！对于行政机关不作为的情况，可以先发出检察建议，督促其依法履职。",
              score: 10
            },
            {
              text: "直接立案开展公益诉讼调查",
              hint: "不完全正确。根据法律规定，提起公益诉讼前应当先履行诉前程序，督促行政机关履职。",
              score: 5
            },
            {
              text: "联合环保部门共同开展检查",
              hint: "不完全错误。虽然可以协作，但不能替代法律规定的监督程序。",
              score: 2
            },
            {
              text: "告知群众向环保部门举报",
              hint: "完全错误。检察机关作为法律监督机关，对环境公益损害问题负有监督职责。",
              score: 0
            }
          ]
        },
        {
          number: 5,
          title: "刑事申诉案件",
          content: "晚上8点，你收到一起刑事申诉案件。申诉人王某因抢劫罪被判处有期徒刑5年，他声称自己是被冤枉的，有新的证据证明其不在场。",
          type: ProcuratorialType.CRIMINAL,
          options: [
            {
              text: "决定对案件进行复查，调阅案卷材料并核实新证据",
              hint: "完全正确！对于有新证据可能影响定罪量刑的申诉案件，应当进行复查。",
              score: 10
            },
            {
              text: "要求原审法院对新证据进行审查并反馈意见",
              hint: "不完全正确。虽然可以要求法院协助，但检察机关应当亲自进行审查。",
              score: 5
            },
            {
              text: "告知申诉人向原审法院申请再审",
              hint: "不完全错误。虽然申诉人也可以向法院申请再审，但检察机关也有监督职责。",
              score: 2
            },
            {
              text: "以申诉理由不成立为由驳回申诉",
              hint: "完全错误。未对新证据进行审查就驳回申诉，可能导致冤案。",
              score: 0
            }
          ]
        },
        {
          number: 6,
          title: "行政诉讼监督案件",
          content: "上午9点，你收到一起行政诉讼监督申请。申请人认为某行政机关作出的行政处罚决定认定事实不清，适用法律错误，但法院判决维持了该处罚决定。",
          type: ProcuratorialType.ADMINISTRATIVE,
          options: [
            {
              text: "受理申请，调阅行政诉讼案卷，对行政行为的合法性进行全面审查",
              hint: "完全正确！检察机关应当对行政诉讼案件进行全面监督，确保行政机关依法行政。",
              score: 10
            },
            {
              text: "仅审查法院的审判活动是否合法",
              hint: "不完全正确。检察机关不仅要监督审判活动，还要监督行政行为的合法性。",
              score: 5
            },
            {
              text: "建议申请人向上一级法院申请再审",
              hint: "不完全错误。虽然申请人可以申请再审，但检察机关也应当履行监督职责。",
              score: 2
            },
            {
              text: "以不属于监督范围为由不予受理",
              hint: "完全错误。行政诉讼监督是检察机关的法定职责。",
              score: 0
            }
          ]
        },
        {
          number: 7,
          title: "虚假诉讼监督线索",
          content: "下午2点，你收到一条虚假诉讼线索，反映某公司通过虚构债务纠纷提起诉讼，意图逃避债务。",
          type: ProcuratorialType.CIVIL,
          options: [
            {
              text: "立案调查，收集证据，如属实则向法院提出再审检察建议",
              hint: "完全正确！对于虚假诉讼，检察机关应当依法监督，维护司法公正。",
              score: 10
            },
            {
              text: "将线索移送公安机关处理",
              hint: "不完全正确。虽然虚假诉讼可能构成犯罪，但检察机关也应当先履行诉讼监督职责。",
              score: 5
            },
            {
              text: "建议当事人自行向法院申请撤销诉讼",
              hint: "不完全错误。虽然当事人可以申请撤诉，但检察机关应当主动监督。",
              score: 2
            },
            {
              text: "以没有直接证据为由不予受理",
              hint: "完全错误。检察机关应当对线索进行调查核实，而不是仅依赖现有证据。",
              score: 0
            }
          ]
        },
        {
          number: 8,
          title: "未成年人被害人保护",
          content: "上午11点，你收到一起性侵害未成年人案件。被害人是一名12岁的女童，案件办理过程中需要对其进行询问。",
          type: ProcuratorialType.JUVENILE,
          options: [
            {
              text: "在未成年人检察工作室进行询问，由女性检察人员进行，并通知法定代理人到场",
              hint: "完全正确！询问未成年被害人应当采取适当方式，保护其身心健康。",
              score: 10
            },
            {
              text: "在检察院办公室进行询问，由主办检察官负责",
              hint: "不完全正确。没有充分考虑到未成年人的特殊心理需求和保护要求。",
              score: 5
            },
            {
              text: "建议公安机关对被害人进行询问",
              hint: "不完全错误。虽然公安机关可以询问，但检察机关也应当履行对未成年人的特殊保护职责。",
              score: 2
            },
            {
              text: "多次询问被害人以获取详细陈述",
              hint: "完全错误。反复询问可能对未成年被害人造成二次伤害。",
              score: 0
            }
          ]
        },
        {
          number: 9,
          title: "食品药品安全公益诉讼",
          content: "下午4点，你接到群众举报，某餐馆使用过期食材制作食品，存在严重安全隐患。",
          type: ProcuratorialType.PUBLIC_INTEREST,
          options: [
            {
              text: "联合市场监管部门开展检查，如属实则发出检察建议督促依法处理",
              hint: "完全正确！对于食品药品安全问题，检察机关应当通过公益诉讼等方式进行监督。",
              score: 10
            },
            {
              text: "直接向法院提起公益诉讼",
              hint: "不完全正确。根据法律规定，提起公益诉讼前应当先履行诉前程序。",
              score: 5
            },
            {
              text: "将线索移送市场监管部门处理",
              hint: "不完全错误。虽然市场监管部门有监管职责，但检察机关也应当履行法律监督职责。",
              score: 2
            },
            {
              text: "告知举报人向消费者协会投诉",
              hint: "完全错误。检察机关作为法律监督机关，对食品药品安全领域的公益损害问题负有监督职责。",
              score: 0
            }
          ]
        },
        {
          number: 10,
          title: "羁押必要性审查",
          content: "晚上7点，你收到一起羁押必要性审查申请。犯罪嫌疑人赵某因涉嫌诈骗罪被逮捕，现已被羁押3个月，案件正在审查起诉阶段。经审查，赵某认罪认罚，积极退赃，且系初犯。",
          type: ProcuratorialType.CRIMINAL,
          options: [
            {
              text: "启动羁押必要性审查，认为没有继续羁押的必要，建议办案机关变更强制措施为取保候审",
              hint: "完全正确！对于认罪认罚、积极退赃且无社会危险性的犯罪嫌疑人，可以建议变更强制措施。",
              score: 10
            },
            {
              text: "维持原逮捕决定，因为案件尚未审结",
              hint: "不完全正确。羁押必要性审查应当根据案件进展和犯罪嫌疑人的具体情况进行动态评估。",
              score: 5
            },
            {
              text: "要求公安机关提供继续羁押的理由",
              hint: "不完全错误。虽然可以要求公安机关说明理由，但检察机关应当主动进行审查。",
              score: 2
            },
            {
              text: "以案件正在办理中为由不予受理审查申请",
              hint: "完全错误。羁押必要性审查是检察机关的法定职责，应当依法受理并进行审查。",
              score: 0
            }
          ]
        }
      ];
      
      // Initial skills data
      const initialSkills = [
        { name: "刑事检察", type: ProcuratorialType.CRIMINAL, value: 0 },
        { name: "民事检察", type: ProcuratorialType.CIVIL, value: 0 },
        { name: "行政检察", type: ProcuratorialType.ADMINISTRATIVE, value: 0 },
        { name: "公益诉讼", type: ProcuratorialType.PUBLIC_INTEREST, value: 0 },
        { name: "未成年人检察", type: ProcuratorialType.JUVENILE, value: 0 }
      ];
      
      // Game state
      let gameState = {
        currentScreen: 'cover',
        score: 0,
        answers: [],
        currentCase: 1,
        skillScores: {
          criminal: { total: 0, max: 0 },
          civil: { total: 0, max: 0 },
          administrative: { total: 0, max: 0 },
          publicInterest: { total: 0, max: 0 },
          juvenile: { total: 0, max: 0 }
        },
        selectedOption: null
      };
      
      // DOM elements - 修正了这里的引用
      const screens = {
        cover: document.getElementById('coverScreen'),
        case: document.getElementById('caseScreen'),
        result: document.getElementById('resultScreen')
      };
      
      const caseElements = {
        number: document.getElementById('caseNumber'),
        title: document.getElementById('caseTitle'),
        content: document.getElementById('caseContent'),
        optionsContainer: document.getElementById('optionsContainer'),
        nextButton: document.getElementById('nextButton')
      };
      
      const resultElements = {
        score: document.getElementById('finalScore'),
        rankBadge: document.getElementById('rankBadge'),
        rankTitle: document.getElementById('rankTitle'),
        rankDescription: document.getElementById('rankDescription'),
        skillsContainer: document.getElementById('skillsContainer'),
        commentContainer: document.getElementById('commentContainer')
      };
      
      // Utility functions
      function shuffleArray(array) {
        const newArray = [...array];
        for (let i = newArray.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
        }
        return newArray;
      }
      
      function generateComment(score) {
        if (score >= 80) return "您展现卓越的综合检察素养，对各业务条线的职能定位理解精准。建议继续关注司法前沿动态，保持专业领先优势。";
        if (score >= 60) return "您具备扎实的检察业务基础，对四大检察和未成年人检察工作有较全面的把握。建议加强对新类型案件和新兴领域法律问题的研究。";
        if (score >= 40) return "您对检察基本职能有初步了解，但在具体法律监督程序的把握上仍需加强。建议系统学习'四大检察'职能体系和相关法律法规。";
        if (score >= 20) return "您对检察工作有一定认识，但法律专业知识和检察业务能力有待提高。建议多参与业务培训和案例研讨，提升专业水平。";
        return "检察工作专业性强、程序性要求高。建议您多关注检察机关公开发布的典型案例和职能介绍，系统学习法律知识，逐步提升认知水平。";
      }
      
      function calculateRank(score) {
        if (score >= 90) {
          return {
            rank: "资深检察官",
            title: "法理精通，游刃有余",
            desc: "您展现了卓越的法律素养和检察业务能力！"
          };
        } else if (score >= 70) {
          return {
            rank: "骨干检察官",
            title: "业务扎实，独当一面",
            desc: "您具备了优秀检察官的核心能力！"
          };
        } else if (score >= 50) {
          return {
            rank: "合格检察官",
            title: "基本胜任，仍需精进",
            desc: "您已掌握基础检察职能，继续加油！"
          };
        } else if (score >= 30) {
          return {
            rank: "见习检察官",
            title: "初窥门径，继续学习",
            desc: "您对检察工作有初步认识，建议加强学习。"
          };
        } else {
          return {
            rank: "法治学员",
            title: "潜力可期，再接再厉",
            desc: "检察工作专业性强，期待您的进步！"
          };
        }
      }
      
      function calculateSkills() {
        return initialSkills.map(skill => {
          const scores = gameState.skillScores[skill.type];
          const percentage = scores.max > 0 ? Math.round((scores.total / scores.max) * 100) : 0;
          return {
            ...skill,
            value: Math.max(percentage, 10) // 确保最低显示10%
          };
        });
      }
      
      // Screen management functions
      function showScreen(screenName) {
        // Hide all screens
        Object.values(screens).forEach(screen => {
          screen.classList.remove('active');
        });
        
        // Show the selected screen - 修正了这里的显示逻辑
        if (screens[screenName]) {
          screens[screenName].classList.add('active');
          gameState.currentScreen = screenName;
        } else {
          console.error(`Screen "${screenName}" not found`);
        }
      }
      
      function loadCase(caseNumber) {
        const gameCase = cases.find(c => c.number === caseNumber);
        if (!gameCase) return;
        
        // Update case elements
        caseElements.number.textContent = `案件 #${gameCase.number}/10`;
        caseElements.title.textContent = gameCase.title;
        caseElements.content.textContent = gameCase.content;
        
        // Clear previous options
        caseElements.optionsContainer.innerHTML = '';
        
        // Shuffle options
        const shuffledOptions = shuffleArray(gameCase.options);
        
        // Create option elements
        shuffledOptions.forEach((option, index) => {
          const optionElement = document.createElement('div');
          optionElement.className = 'option';
          optionElement.dataset.index = index;
          
          // Add option text
          const textElement = document.createElement('div');
          textElement.className = 'option-text';
          textElement.textContent = option.text;
          optionElement.appendChild(textElement);
          
          // Add option hint
          const hintElement = document.createElement('div');
          hintElement.className = 'option-hint';
          hintElement.textContent = option.hint;
          optionElement.appendChild(hintElement);
          
          // Add correct indicator
          const correctElement = document.createElement('div');
          correctElement.className = 'option-correct';
          correctElement.textContent = '✓';
          optionElement.appendChild(correctElement);
          
          // Add click event
          optionElement.addEventListener('click', () => {
            handleOptionSelect(optionElement, option);
          });
          
          caseElements.optionsContainer.appendChild(optionElement);
        });
        
        // Reset state
        gameState.selectedOption = null;
        caseElements.nextButton.classList.remove('visible');
      }
      
      function handleOptionSelect(optionElement, option) {
        // Remove selected class from all options
        document.querySelectorAll('.option').forEach(el => {
          el.classList.remove('selected');
        });
        
        // Add selected class to clicked option
        optionElement.classList.add('selected');
        gameState.selectedOption = option;
        
        // Show next button
        caseElements.nextButton.classList.add('visible');
      }
      
      function handleCaseComplete() {
        if (!gameState.selectedOption) return;
        
        // Update score
        gameState.score += gameState.selectedOption.score;
        gameState.answers.push({
          score: gameState.selectedOption.score,
          hint: gameState.selectedOption.hint
        });
        
        // Update skill scores
        const currentCaseData = cases.find(c => c.number === gameState.currentCase);
        if (currentCaseData) {
          gameState.skillScores[currentCaseData.type] = {
            total: gameState.skillScores[currentCaseData.type].total + gameState.selectedOption.score,
            max: gameState.skillScores[currentCaseData.type].max + 10 // 每题满分10分
          };
        }
        
        // Move to next case or show results
        if (gameState.currentCase < cases.length) {
          gameState.currentCase++;
          loadCase(gameState.currentCase);
        } else {
          showResults();
        }
      }
      
      function showResults() {
        // Update result elements
        resultElements.score.textContent = gameState.score;
        
        // Calculate rank
        const rankInfo = calculateRank(gameState.score);
        resultElements.rankBadge.textContent = rankInfo.rank;
        resultElements.rankTitle.textContent = rankInfo.title;
        resultElements.rankDescription.textContent = rankInfo.desc;
        
        // Clear previous skills
        resultElements.skillsContainer.innerHTML = '';
        
        // Calculate and display skills
        const skills = calculateSkills();
        skills.forEach(skill => {
          const skillItem = document.createElement('div');
          skillItem.className = 'skill-item';
          
          const skillHeader = document.createElement('div');
          skillHeader.className = 'skill-header';
          
          const skillName = document.createElement('span');
          skillName.textContent = skill.name;
          
          const skillValue = document.createElement('span');
          skillValue.textContent = '0%';
          skillValue.id = `skill-value-${skill.type}`;
          
          skillHeader.appendChild(skillName);
          skillHeader.appendChild(skillValue);
          
          const skillBarContainer = document.createElement('div');
          skillBarContainer.className = 'skill-bar-container';
          
          const skillBar = document.createElement('div');
          skillBar.className = 'skill-bar';
          skillBar.id = `skill-bar-${skill.type}`;
          
          skillBarContainer.appendChild(skillBar);
          
          skillItem.appendChild(skillHeader);
          skillItem.appendChild(skillBarContainer);
          
          resultElements.skillsContainer.appendChild(skillItem);
        });
        
        // Generate comment
        resultElements.commentContainer.textContent = generateComment(gameState.score);
        
        // Show result screen
        showScreen('result');
        
        // Animate skill bars after a short delay
        setTimeout(() => {
          skills.forEach(skill => {
            const skillBar = document.getElementById(`skill-bar-${skill.type}`);
            const skillValue = document.getElementById(`skill-value-${skill.type}`);
            
            // Animate the width of the bar
            setTimeout(() => {
              skillBar.style.width = `${skill.value}%`;
              skillValue.textContent = `${skill.value}%`;
            }, 500 + skills.findIndex(s => s.type === skill.type) * 100);
          });
        }, 300);
      }
      
      function restartGame() {
        // Reset game state
        gameState = {
          currentScreen: 'cover',
          score: 0,
          answers: [],
          currentCase: 1,
          skillScores: {
            criminal: { total: 0, max: 0 },
            civil: { total: 0, max: 0 },
            administrative: { total: 0, max: 0 },
            publicInterest: { total: 0, max: 0 },
            juvenile: { total: 0, max: 0 }
          },
          selectedOption: null
        };
        
        // Show cover screen
        showScreen('cover');
      }
      
      function shareResult() {
        const rankInfo = calculateRank(gameState.score);
        const shareText = `我在《正义链：检察官的24小时》中获得${gameState.score}分，被评为"${rankInfo.rank}"！快来测试你的检察业务能力吧！`;
        
        if (navigator.share) {
          navigator.share({
            title: "检察官能力测试",
            text: shareText,
            url: window.location.href
          });
        } else {
          alert("请手动复制分享：\n\n" + shareText);
        }
      }
      
      // 为了确保所有DOM元素都已加载，我们在DOMContentLoaded事件中绑定事件监听器
      // Event listeners - 修正了这里的事件绑定
      const startButton = document.getElementById('startButton');
      if (startButton) {
        startButton.addEventListener('click', function() {
          console.log('Start button clicked');
          showScreen('case');
          loadCase(gameState.currentCase);
        });
      } else {
        console.error('Start button not found');
      }
      
      const nextButton = document.getElementById('nextButton');
      if (nextButton) {
        nextButton.addEventListener('click', handleCaseComplete);
      }
      
      const restartButton = document.getElementById('restartButton');
      if (restartButton) {
        restartButton.addEventListener('click', restartGame);
      }
      
      const shareButton = document.getElementById('shareButton');
      if (shareButton) {
        shareButton.addEventListener('click', shareResult);
      }
      
      // Initialize the game
      showScreen('cover');
    });
  </script>
</body>
</html>